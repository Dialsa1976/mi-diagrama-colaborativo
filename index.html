<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrama Colaborativo</title>
    <style>
        /* Tus estilos actuales */
    </style>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <!-- LibrerÃ­a draw.io CORRECTA -->
    <script src="https://unpkg.com/@diagramsnet/viewer@latest"></script>
</head>
<body>
    <!-- Tu interfaz actual -->
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBGrtio9lIc922TT9KyC0nkG8mMYyheOHM",
            authDomain: "dislicores-app-bdf8c.firebaseapp.com",
            databaseURL: "https://dislicores-app-bdf8c-default-rtdb.firebaseio.com",
            projectId: "dislicores-app-bdf8c",
            storageBucket: "dislicores-app-bdf8c.firebasestorage.app",
            messagingSenderId: "245350083614",
            appId: "1:245350083614:web:ac48215a31500f0952920f"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const diagramRef = db.ref('diagrama_colaborativo');

        let editor;
        let ignoreUpdates = false;

        function initEditor() {
            const container = document.getElementById('diagramContainer');
            
            editor = new diagramsnet.EmbeddedViewer(container, {
                ui: 'min',
                zoom: '1',
                fit: '1',
                spin: '1',
                saveAndExit: false,
                lang: 'es',
                allowCustomPanels: false
            });

            editor.on('ready', () => {
                document.getElementById('status').textContent = "ðŸŸ¢ Editor listo";
                
                diagramRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data && !ignoreUpdates) {
                        editor.load(data.xml);
                    }
                });
            });

            editor.on('save', (xml) => {
                if (!ignoreUpdates) {
                    document.getElementById('status').textContent = "ðŸ”„ Guardando...";
                    diagramRef.set({ xml }).then(() => {
                        document.getElementById('status').textContent = "ðŸŸ¢ Guardado y sincronizado";
                    });
                }
            });
        }

        window.addEventListener('DOMContentLoaded', initEditor);
    </script>
</body>
</html>